@model resWebApp.Models.ReservationModel
@using resWebApp.CustomeHelper
@using resWebApp.Resources
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    //ViewBag.Title = "Home Page";
    System.Threading.Thread.CurrentThread.CurrentCulture = new System.Globalization.CultureInfo(Session["lang"] as string);
    System.Threading.Thread.CurrentThread.CurrentUICulture = System.Threading.Thread.CurrentThread.CurrentCulture;

    var confirmDisplay="";
    if (Model.status == "confirm") {
        confirmDisplay = "none";
    }
    else {
        confirmDisplay = "";
    }
}



    <section class="statis">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="c-profile">
                        <div class="row">
                            <div class="col-4">
                                @if (ViewBag.Image == null || ViewBag.Image == "")
                                {
                                    <img src=@Url.Content("~/" + Session["lang"].ToString() + "/images/avatar.jpg") id="img_Customer" alt="" class="rounded mx-auto text-center">
                                }
                                else
                                {
                                    <img src="@Url.Content(ViewBag.Image)" id="img_Customer" alt="" class="rounded mx-auto text-center">
                                }
                            </div>
                            <div class="col-8 details">
                                <div>
                                    <p><span>@AppResource.ResNumber: </span>@Model.code</p>
                                </div>
                                <div>
                                    <p><span>@AppResource.Customer: </span>@if (Model.customer != null) { Html.customerNameConverter(Model.customer.name); }</p>
                                </div>
                                <div>
                                    <p><span>@AppResource.Mobile: </span>@if (Model.customer != null) { Html.customerNameConverter(Model.customer.mobile); }</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="bcrumb-block">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a id="a_title" href="#">@AppResource.Reservations</a></li>
                                <li class="breadcrumb-item active" aria-current="page">@AppResource.Details</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="details-block">
                        <span class="red"></span>
                        <div class="row">
                            <div class="col-4 text-center mt-3 br-3">
                                <svg class="red" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                     viewBox="0 0 141.7 141.7" style="enable-background:new 0 0 141.7 141.7;" xml:space="preserve">
                                <path d="M108.4,107.7c-6,0-12.1,0-18.2,0c-0.9,0.1-1.8-0.2-2.6-0.7c-6.5-6.1-9.5-13.1-5.9-22.2c1.9-4.9,4.6-9.4,7.1-14
							c2.8-5,5.8-9.9,7.1-15.6c1.1-4.7,0.3-9.5-2.3-13.6c-0.3-0.4-0.5-0.9-0.8-1.6h-44c0,0.2-0.1,0.4-0.1,0.6c-0.3,0.4-0.5,0.8-0.8,1.3
							c-2.3,3.9-3.6,8.1-2.3,12.6c1.3,4.1,2.8,8.1,4.7,12c2.9,6,6.7,11.7,9.4,17.8c3.7,8.4,1.6,16.2-5.3,22.4c-0.8,0.7-1.9,1.1-3,1.1
							c-5.6,0.1-11.2,0.1-16.8,0.1c-3.9,0-5.9,1.5-5.9,4.4c0.1,2.9,1.9,4.3,5.8,4.3h47c8.8,0,17.6,0.1,26.4-0.1c1.4,0,2.8-0.5,3.9-1.3
							c1.4-1.2,1.6-2.9,0.8-4.6C111.9,108.6,110.2,107.6,108.4,107.7z M134.3,25.1c-8,0-16.1,0.3-24.1,0.3c-5.2,0-10.3-0.3-15.5-0.3
							c-18.1,0-36.2,0-54.3,0c-2.8,0-5.7,0.2-8.5,0.2c-8.4,0-16.7-0.2-25-0.1c-2.6,0-4.9,1.5-6,3.9c-2.6,5.1,0.8,10.7,6.7,10.7
							c13,0,26,0,38.9,0h48.8c12.8,0,25.7,0,38.5,0c3.1,0,5.5-1.1,6.9-3.9c1.9-3.5,0.7-7.9-2.8-9.8C136.8,25.3,135.5,25.1,134.3,25.1z" />



						</svg>
                            </div>
                            <div class="col-8 text-center">
                                <label for="tables">@AppResource.Tables</label>
                                <p id="tables">@Html.tablesNameConverter(Model.tables.ToList())</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="details-block">
                        <span class="red"></span>
                        <div class="row">
                            <div class="col-4 text-center mt-3 br-3">
                                <svg class="red" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">
                                <path d="M892,990H108c-36.1,0-65.3-61.9-65.3-98V173.4c0-36.1,29.2-65.3,65.3-65.3h98v32.7c0,54.1,43.9,98,98,98c54.1,0,98-43.9,98-98V108h196v32.7c0,54.1,43.9,98,98,98c54.2,0,98-43.9,98-98V108h98c36.1,0,65.3,29.2,65.3,65.3V892C957.4,928.1,928.1,990,892,990L892,990z M859.3,336.7H140.7V892h718.7V336.7L859.3,336.7z M304,500h-98v-98h98V500L304,500z M304,663.3h-98v-98h98V663.3L304,663.3z M304,826.6h-98v-98h98V826.6L304,826.6z M467.3,500h-98v-98h98V500L467.3,500z M467.3,663.3h-98v-98h98V663.3L467.3,663.3z M467.3,826.6h-98v-98h98V826.6L467.3,826.6z M630.7,500h-98v-98h98V500L630.7,500z M630.7,663.3h-98v-98h98V663.3L630.7,663.3z M630.7,826.6h-98v-98h98V826.6L630.7,826.6z M794,500h-98v-98h98V500L794,500z M794,663.3h-98v-98h98V663.3L794,663.3z M794,826.6h-98v-98h98V826.6L794,826.6z M695,206c-35.5,0-64.3-28.8-64.3-64.3V74.3c0-35.5,28.8-64.3,64.3-64.3c35.5,0,64.3,28.8,64.3,64.3v67.4C759.3,177.2,730.5,206,695,206L695,206z M303,206c-35.5,0-64.3-28.8-64.3-64.3V74.3c0-35.5,28.8-64.3,64.3-64.3c35.5,0,64.3,28.8,64.3,64.3v67.4C367.3,177.2,338.5,206,303,206L303,206z" /></g>
							</svg>
                            </div>
                            <div class="col-8 text-center">
                                <label for="date">@AppResource.Date</label>
                                <p id="date">@Model.reservationDate.ToString().Split(' ')[0]</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="details-block">
                        <span class="red"></span>
                        <div class="row">
                            <div class="col-4 text-center mt-3 br-3">
                                <svg class="red" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                     width="64px" height="64px" viewBox="0 0 64 64" style="enable-background:new 0 0 64 64;" xml:space="preserve">
                                <path d="M32,30c-1.104,0-2,0.896-2,2c0,1.104,0.896,2,2,2c1.104,0,2-0.896,2-2C34,30.896,33.104,30,32,30z M63,33h-2
									c-0.553,0-1-0.447-1-1s0.447-1,1-1h2c0.553,0,1,0.447,1,1C64,14.327,49.673,0,32,0c0.553,0,1,0.447,1,1v2c0,0.553-0.447,1-1,1
									c-0.553,0-1-0.447-1-1V1c0-0.553,0.447-1,1-1C14.327,0,0,14.327,0,32c0-0.553,0.447-1,1-1h2c0.553,0,1,0.447,1,1s-0.447,1-1,1H1
									c-0.553,0-1-0.447-1-1c0,17.673,14.327,32,32,32c-0.553,0-1-0.447-1-1v-2c0-0.552,0.447-1,1-1c0.553,0,1,0.448,1,1v2
									c0,0.553-0.447,1-1,1c17.673,0,32-14.327,32-32C64,32.553,63.553,33,63,33z M31,12c0-0.552,0.448-1,1-1c0.553,0,1,0.448,1,1v14
									h-2V12z M32,36c-2.209,0-4-1.791-4-4s1.791-4,4-4s4,1.791,4,4S34.209,36,32,36z M46,33h-8v-2h8c0.553,0,1,0.448,1,1
									C47,32.553,46.553,33,46,33z" />



							</svg>
                            </div>
                            <div class="col-8 text-center">
                                <label for="time">@AppResource.StartTime</label>
                                <p id="time">@Html.concatTimeWithPM_AM(Model.reservationTime.ToString().Split(' ')[1], Model.reservationTime.ToString().Split(' ')[2])</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="details-block">
                        <span class="red"></span>
                        <div class="row">
                            <div class="col-4 text-center mt-3 br-3">
                                <svg class="red" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 117.12 122.88">
                                    <path class="cls-1" d="M35.79,38.93v78.23a5.73,5.73,0,0,1-5.71,5.72h0a5.73,5.73,0,0,1-5.72-5.72v-46H22.11v46a5.74,5.74,0,0,1-5.72,5.72h0a5.74,5.74,0,0,1-5.72-5.72V38.93h-2V67.68A4.34,4.34,0,0,1,4.34,72h0A4.35,4.35,0,0,1,0,67.68V36.74c0-5,1.69-8.56,4.77-10.88,5.3-4,31.46-4,36.76,0,3.09,2.32,4.8,5.85,4.79,10.88V67.68A4.35,4.35,0,0,1,42,72h0a4.35,4.35,0,0,1-4.34-4.33V38.93Zm72-3.39a3.13,3.13,0,0,1,.19.54L117,67.88a4.44,4.44,0,1,1-8.55,2.4L99.57,38.9l-.13,0H97.6v2l11.76,46.8H97.6v29.44a5.74,5.74,0,0,1-5.72,5.72h0a5.73,5.73,0,0,1-5.72-5.72V87.72H83.91v29.44a5.73,5.73,0,0,1-5.72,5.72h0a5.73,5.73,0,0,1-5.71-5.72V87.72H60l12.47-48v-.75h-2l-.17,0L61.49,70.28a4.45,4.45,0,0,1-8.56-2.4l8.75-31.12-.09,0c1.34-5,2.46-8.56,5.54-10.88,5.3-4,30.91-4,36.21,0,2.85,2.14,3.35,5,4.48,9.68ZM85,0A10.34,10.34,0,1,1,74.62,10.34,10.34,10.34,0,0,1,85,0ZM23.16,0A10.34,10.34,0,1,1,12.82,10.34,10.34,10.34,0,0,1,23.16,0Z" />
                                </svg>
                            </div>
                            <div class="col-8 text-center">
                                <label for="p-count">@AppResource.PersonsCount</label>
                                <p id="p-count">@Model.personsCount</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="details-block">
                        <span class="red"></span>
                        <div class="row">
                            <div class="col-4 text-center mt-3 br-3">
                                <svg class="red" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 84.68">
                                    <path d="M24.15,0H99.91a8.94,8.94,0,0,1,6.48,2.71h0a12.7,12.7,0,0,1,3.3,6.51l13,65a7.91,7.91,0,0,1,.15,1.52,8.31,8.31,0,0,1-2.59,5.9,10.71,10.71,0,0,1-5.39,2.86h0a9.87,9.87,0,0,1-2,.2H38.11c-.26,0-.52,0-.77,0H5.81C1.44,84.22-.28,81,0,76.75l12.23-62c.72-2.77,1.39-5.67,2.24-8A7.83,7.83,0,0,1,15,5.48h0l.05-.1h0A8.82,8.82,0,0,1,16.74,3.1,10.78,10.78,0,0,1,22,.23,10.27,10.27,0,0,1,24.15,0ZM48.51,47c-5-5.37,2.66-13.35,8.19-8.3,1.95,1.78,4.79,4.38,6.76,6.15L77.92,26.91c5.3-5.46,13.64,2.56,8.42,8.06L68,57a5.88,5.88,0,0,1-8.14.36c-3.23-3.08-8-7.51-11.36-10.35ZM99.91,6.51H24.15a3.79,3.79,0,0,0-.77.08,4.13,4.13,0,0,0-2,1.09,1.86,1.86,0,0,0-.63,1.24c1.57,16.67,10.15,47.38,14,65.23a6.54,6.54,0,0,0,1.57,3.23h0a2.56,2.56,0,0,0,1.85.78h74.83a4,4,0,0,0,.69-.07h0a4.16,4.16,0,0,0,2.08-1.1,2,2,0,0,0,.66-1.3l0-.25-13-65a6.2,6.2,0,0,0-1.52-3.18,2.59,2.59,0,0,0-1.88-.8Z" />
                                </svg>
                            </div>
                            <div class="col-8 text-center">
                                <label for="status">@AppResource.Status</label>
                                <p id="status">@Html.reservationStatusConverter(Model.status)</p>
                            </div>
                        </div>
                    </div>
                </div>

                    <div id="div-warning" class="col-12 warning mb-3" style="display:none">
                        <div id="warning-msg" class="alert alert-warning mb-0" role="alert"></div>
                    </div>
            <div class="col-12 mb-3">
                <input type="hidden" id="resBranchId" value="@Model.branchId" />
                <input type="hidden" id="reservationId" value="@Model.reservationId" />
                <input type="hidden" id="customerId" value="@Model.customerId" />
                <button id="btn-confirm" class="btn btn-danger btn-block back" style="display:@confirmDisplay" onclick="confirm()">@AppResource.Confirm</button>
            </div>

                <div class="col-12">
                    @using (Html.BeginForm("Reservations", "Reservations",new { branchId=int.Parse(Session["branchId"].ToString())}, FormMethod.Post, new { id = "form1" }))
                    {
                        <input type="hidden" id="branchId" value="@Session["branchId"].ToString()" />
                        <button id="btn_back" class="btn btn-dark btn-block back mb-3">@AppResource.Back</button>
                    }
                </div>
            </div>
        </div>
    </section>
<div class="scroll-to-top" title="Go Up">
    <i class="fa fa-chevron-up fa-lg"></i>
</div>

<script>

      function confirm() {
        var bId = $('#resBranchId').val();
        if (bId == "")
              bId = 0;
          var reservationId = $('#reservationId').val();

        $.ajax({
            url: '@Url.Action("validateTablesBeforeConfirm", "Reservations")',
            data: { branchId: bId, reservationId: reservationId },
            type: "POST",
            async: false,
            success: function (result) {
                if (result.message != "") {
                    $('#div-warning').show();
                    $('#warning-msg').html(result.message);
                }
                else {
                    var cId = $('#customerId').val();
                         $.ajax({
                             url: '@Url.Action("ReservtionConfirm", "Reservations")',
                             data: { reservationId: reservationId, customerId: cId, branchId: bId },
                        type: "POST",
                        async: false,
                             success: function (result) {
                                 $('#btn-confirm').hide();
                                 $('#status').text('@AppResource.Confirmed');
                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown) {
                        alert('oops, something bad happened');
                        }
                    });
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
            alert('oops, something bad happened');
            }
        });
        }

     $('#btn_back').click(function () {
       
        goBack();
     });

     $('#a_title').click(function() {
         goBack();

        });

    function goBack() {
        var branchId = $('#branchId').val();

        if (branchId == null)
            branchId = 0;

        var action = 'Reservations?branchId=' + branchId;
        $('#form1').attr('action', action);
         $('#form1').submit();

          return false;
    }
</script>
